import{d as e,E as a,k as t,j as l,n as o,z as n,o as i,c as s,p as r,w as c,G as d,R as u,a as p,ab as g,l as f,m as h,q as m,t as b,B as y,s as v,r as w,L as _,O as k,a2 as D,a3 as $,ae as x,af as I,a5 as L,a6 as T,P as B,Q as C,x as M,y as z,J as U,F as V,A}from"./vendor.e716bcd5.js";import{r as R,P as E,I as S,a as G,u as O,g as H,_ as P,b as N,i as F,c as j,d as q,s as X,e as W,L as Z,E as J,f as K,D as Q,h as Y,B as ee,j as ae,k as te,l as le,G as oe}from"./index.6c9be489.js";const ne=e=>R({url:"/user",method:"GET",headers:{Authorization:`Bearer ${e}`}}),ie=(e,a=1)=>new Promise((async t=>{const l=await R({url:`users/${e}/repos`,method:"GET",params:{type:"owner",sort:"created",direction:"desc",per_page:100,page:a}});l&&l.length?t(l.filter((e=>!e.fork&&!e.private)).map((e=>({value:e.name,label:e.name})))):t(null)})),se=async e=>{const a=[];for(let t=1;t<=3;t++){const l=await ie(e,t);l&&a.push(...l)}return Promise.resolve(a.length?a:null)},re=async(t,l=!0)=>{const{owner:o,selectedRepo:n,selectedBranch:i}=t;let s=null;l&&(s=e.service({text:"正在初始化仓库..."}));await R({url:`/repos/${o}/${n}/contents/README.md`,method:"PUT",data:{message:E,branch:i,content:window.btoa("\n# Welcome to use PicX\n\n[PicX](https://github.com/XPoet/picx) is a simple and powerful image hosting tool. It supports image hosting services via GitHub repository.\n\nPicX is completely open source, and you can use it for free.\n\nIf you like it, please give it a star on [GitHub](https://github.com/XPoet/picx).\n        ")},noShowErrorMsg:!0})?null==s||s.close():l&&a.error("仓库初始化失败")};var ce=N(t({__name:"refresh-config",props:{boxWidth:{type:Number,default:20},dataType:{type:String,default:"repo"}},setup(a){const t=u(),p=O(),g=l((()=>p.getters.getUserConfigInfo)).value,f=a,h=async()=>{const a=e.service({lock:!0,text:t.proxy.$t("config.loading4",{type:t.proxy.$t(f.dataType)})}),{owner:l,selectedRepo:o}=g;if("repo"===f.dataType){const e=await se(l);e&&(g.repoList=e)}else if("branch"===f.dataType){const e=await H(l,o);e.length&&(g.branchList=e)}a.close(),await p.dispatch("USER_CONFIG_INFO_PERSIST")};return(e,t)=>{const l=P,u=o,p=n;return i(),s("div",{class:"refresh-config-box",style:d({width:a.boxWidth+"rem"})},[r(p,{placement:"top",content:e.$t("config.reload",{type:e.$t(a.dataType)})},{default:c((()=>[r(u,{class:"icon",onClick:h},{default:c((()=>[r(l)])),_:1})])),_:1},8,["content"])],4)}}}),[["__scopeId","data-v-99b4db60"]]);const de={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"};var ue={name:"ep-switch",render:function(e,a){return i(),s("svg",de,a[0]||(a[0]=[p("path",{fill:"currentColor",d:"M118.656 438.656a32 32 0 0 1 0-45.248L416 96l4.48-3.776A32 32 0 0 1 461.248 96l3.712 4.48a32.064 32.064 0 0 1-3.712 40.832L218.56 384H928a32 32 0 1 1 0 64H141.248a32 32 0 0 1-22.592-9.344M64 608a32 32 0 0 1 32-32h786.752a32 32 0 0 1 22.656 54.592L608 928l-4.48 3.776a32.064 32.064 0 0 1-40.832-49.024L805.632 640H96a32 32 0 0 1-32-32"},null,-1)]))}};const pe={key:0},ge={key:0},fe={key:1},he={key:1};var me=N(t({__name:"authorization-status-bar",setup(e){const a=g({IEpCheck:j,IEpClose:q,IEpSwitch:ue}),{token:t,isAutoAuthorize:o,installed:d}=l((()=>X.getters.getGitHubAuthorizationInfo)).value,u=()=>{W.push({path:"/login",query:{jump:"0"}})};return f((()=>{})),(e,l)=>{const g=h,f=n;return i(),s("div",{class:y(["authorization-status-box border-box",{error:m(o)&&m(t)&&m(F)(),warning:m(o)&&m(t)&&!m(d),success:m(o)&&m(t)&&!m(F)()}])},[p("div",null,[m(o)?(i(),s("span",pe,[m(F)()?(i(),s("span",ge,b(e.$t("authorization.text_4")),1)):(i(),s("span",fe,b(e.$t("authorization.text_3")),1))])):(i(),s("span",he,b(e.$t("authorization.text_5")),1))]),r(f,{placement:"top",content:e.$t("authorization.text_6")},{default:c((()=>[r(g,{type:"primary",text:"",icon:a.value.IEpSwitch,onClick:u},{default:c((()=>[v(b(e.$t("authorization.text_7")),1)])),_:1},8,["icon"])])),_:1},8,["content"])],2)}}}),[["__scopeId","data-v-25a67682"]]);const be=l((()=>X.getters.getUserConfigInfo)).value,ye=async()=>{await X.dispatch("LOGOUT")},ve=async()=>{await X.dispatch("USER_CONFIG_INFO_PERSIST")};async function we(e){be.logined=!0,be.id=e.id,be.owner=e.login,be.name=e.name,be.email=e.email,be.avatarUrl=e.avatar_url,await ve()}const _e=async()=>{const{selectedDir:e,dirMode:t}=be;let l=K.global.t("config.message6");if(""===e){switch(t){case Q.newDir:l=K.global.t("config.message7");break;case Q.repoDir:l=K.global.t("config.message8",{repo:be.selectedRepo})}a.warning({message:l})}else await W.push("/upload")},ke=async()=>{const{token:t}=be;if(!t)return void a.error({message:K.global.t("config.message1")});const o=e.service({lock:!0,text:K.global.t("config.loading6")});try{const e=await ne(be.token);if(!e)return o.close(),void a.error({message:K.global.t("config.message2")});X.getters.getGitHubAuthorizationInfo.isAutoAuthorize||await X.dispatch("SET_GITHUB_AUTHORIZATION_INFO",{manualToken:be.token}),await we(e);const t=await(e=>R({url:"/user/repos",method:"POST",params:{name:S,description:G,private:!1},headers:{Authorization:`Bearer ${e}`},success422:!0,noShowErrorMsg:!0}))(be.token),n=l((()=>X.getters.getGitHubAuthorizationInfo)).value,{token:i,authorized:s}=n;if(await(async(e,t,l)=>{var o;if(t&&l)if(e)await X.dispatch("SET_GITHUB_AUTHORIZATION_INFO",{installed:!0});else{const e=a({customClass:"custom-message-container",duration:0,offset:20,type:"warning",message:`<div class="content-box authorization">\n                    <span class="msg">${K.global.t("authorization.msg_2")}</span>\n                    <spna class="btn-box">\n                      <span class="confirm btn">${K.global.t("authorization.btn_1")}</span>\n                    </spna>\n                  </div>`,dangerouslyUseHTMLString:!0});null==(o=document.querySelector(".custom-message-container .authorization .confirm"))||o.addEventListener("click",(()=>{e.close();let a="https://github.com/apps/picx-app/installations/select_target";be.id&&(a="https://github.com/apps/picx-app/installations/new/permissions?target_id="+be.id),window.location.href=a}))}})(t,s,i),!t)return o.close(),void(s&&i||a.error({message:K.global.t("config.message3")}));be.repoList=[{value:S,label:S}],be.selectedRepo=S,be.branchList=[{value:Y,label:Y}],be.selectedBranch=Y,be.branchMode=ee.repoBranch,be.selectedDir=ae("yyyyMMdd"),be.dirMode=Q.autoDir,be.dirList=[],await ve(),await re(be,!1),o.close(),a.success({message:K.global.t("config.message4")}),await W.push("/upload")}catch(n){a.error({message:K.global.t("config.message5")}),console.error("oneClickAutoConfig >> ",n)}},De=e=>e.language===Z.en?"100rem":"70rem",$e=e=>e.elementPlusSize===J.large?"right":"top";const xe={class:"page-container config-page-container"};var Ie=N(t({__name:"my-config",setup(e){const t=O(),o=u(),p=w(!1),g=w(!1),y=w(!1),R=w(32),E=l((()=>t.getters.getUserConfigInfo)).value,S=l((()=>t.getters.getUserLoginStatus)).value,G=l((()=>t.getters.getUserSettings)).value,P=l((()=>!E.token||!E.owner)),N=l((()=>p.value||g.value||y.value)),j=w(null),q=w("repoDirCascaderKey"),X=w(null),Z=e=>{var a;switch(e){case Q.rootDir:E.selectedDir="/";break;case Q.autoDir:E.selectedDir=ae("yyyyMMdd");break;case Q.newDir:E.selectedDir="xxx",null==(a=j.value)||a.focus();break;case Q.repoDir:E.dirList.length||(E.selectedDir="",E.selectedDirList=[]);break;default:E.selectedDir="/"}ve()};async function J(){g.value=!0;const e=await le(E);g.value=!1,e&&(E.dirList=e),await ve()}async function K(){var e,l;if(!E.token)return void a.error({message:null==(e=null==o?void 0:o.proxy)?void 0:e.$t("config.message1")});P.value||(be.selectedRepo="",be.repoList=[],be.selectedBranch="",be.branchMode=ee.repoBranch,be.branchList=[],be.selectedDir="",be.dirMode=Q.repoDir,be.dirList=[]),p.value=!0;const n=await ne(E.token);n?(t.getters.getGitHubAuthorizationInfo.isAutoAuthorize||await t.dispatch("SET_GITHUB_AUTHORIZATION_INFO",{manualToken:E.token}),await we(n),await async function(e){var t;const l=await se(e);p.value=!1,l?(E.repoList=l,await ve()):a.error({message:null==(t=null==o?void 0:o.proxy)?void 0:t.$t("config.message9")})}(n.login)):a.error({message:null==(l=null==o?void 0:o.proxy)?void 0:l.$t("config.message11")})}function ie(e){E.branchList=[],E.dirList=[],t.dispatch("DIR_IMAGE_LOGOUT"),async function(e){y.value=!0;const{owner:a,dirMode:t}=E,l=await H(a,e);y.value=!1,l.length>0?(E.branchList=l.filter((e=>e.value!==oe)),E.selectedBranch=E.branchList[0].value,E.branchMode=ee.repoBranch,await J()):(E.selectedBranch=Y,E.branchMode=ee.newBranch,await re(E)),Z(t),await ve()}(e),ve()}async function de(e){E.selectedBranch=e,await J(),q.value=E.selectedBranch,E.selectedDir=E.dirList[0].value,E.selectedDirList=[E.selectedDir],await ve()}return _((()=>S),(e=>{e||(p.value=!1,g.value=!1,y.value=!1)})),f((()=>{setTimeout((()=>{var e;E.token&&"1"!==W.currentRoute.value.query.focus||null==(e=X.value)||e.focus(),(()=>{const{token:e,isAutoAuthorize:a}=l((()=>t.getters.getGitHubAuthorizationInfo)).value;a&&e&&!F()&&W.currentRoute.value.query.auto&&ke()})()}),100)})),(e,a)=>{const t=me,l=k,o=D,u=h,f=n,w=$,_=x,S=I,O=ce,H=L,F=T,W=te,J=B;return i(),s("div",xe,[r(t,{style:{"margin-bottom":"20rem"}}),r(w,{"label-width":m(De)(m(G)),"label-position":m($e)(m(G))},{default:c((()=>[r(o,{label:"Token"},{default:c((()=>[r(l,{ref_key:"tokenInputRef",ref:X,modelValue:m(E).token,"onUpdate:modelValue":a[0]||(a[0]=e=>m(E).token=e),clearable:"",autofocus:!m(E).token,type:"password","show-password":"",placeholder:e.$t("config.inputToken")},null,8,["modelValue","autofocus","placeholder"])])),_:1}),r(o,{class:"operation"},{default:c((()=>[r(f,{placement:"top",content:e.$t("config.manualConfiguration3")},{default:c((()=>[r(u,{disabled:N.value,plain:"",type:"info","native-type":"submit",onClick:a[1]||(a[1]=U((e=>K()),["prevent"]))},{default:c((()=>[v(b(P.value?e.$t("config.manualConfiguration1"):e.$t("config.manualConfiguration2")),1)])),_:1},8,["disabled"])])),_:1},8,["content"]),r(f,{placement:"top",content:e.$t("config.autoConfiguration3")},{default:c((()=>[r(u,{plain:"",disabled:N.value,type:"primary",onClick:U(m(ke),["prevent"])},{default:c((()=>[v(b(P.value?e.$t("config.autoConfiguration1"):e.$t("config.autoConfiguration2")),1)])),_:1},8,["disabled","onClick"])])),_:1},8,["content"])])),_:1})])),_:1},8,["label-width","label-position"]),m(E).token&&m(E).owner?C((i(),M(w,{key:0,"label-width":m(De)(m(G)),"label-position":m($e)(m(G)),"element-loading-text":e.$t("config.loading1")},{default:c((()=>[m(E).owner?(i(),M(o,{key:0,label:e.$t("config.username")},{default:c((()=>[r(l,{modelValue:m(E).owner,"onUpdate:modelValue":a[2]||(a[2]=e=>m(E).owner=e),readonly:""},null,8,["modelValue"])])),_:1},8,["label"])):z("",!0),m(E).email?(i(),M(o,{key:1,label:e.$t("config.email")},{default:c((()=>[r(l,{modelValue:m(E).email,"onUpdate:modelValue":a[3]||(a[3]=e=>m(E).email=e),readonly:""},null,8,["modelValue"])])),_:1},8,["label"])):z("",!0),m(E).repoList.length?(i(),M(o,{key:2,label:e.$t("config.selectRepo")},{default:c((()=>[r(S,{modelValue:m(E).selectedRepo,"onUpdate:modelValue":a[4]||(a[4]=e=>m(E).selectedRepo=e),filterable:!0,style:d({width:"calc(100% - "+R.value+"rem)"}),placeholder:e.$t("config.placeholder1"),onChange:ie},{default:c((()=>[(i(!0),s(V,null,A(m(E).repoList,((e,a)=>(i(),M(_,{key:a,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","style","placeholder"]),r(O,{"box-width":R.value,"data-type":"repo"},null,8,["box-width"])])),_:1},8,["label"])):z("",!0)])),_:1},8,["label-width","label-position","element-loading-text"])),[[J,p.value]]):z("",!0),m(E).token&&m(E).selectedRepo&&m(E).branchList.length?C((i(),M(w,{key:1,"label-width":m(De)(m(G)),"label-position":m($e)(m(G)),"element-loading-text":e.$t("config.loading2")},{default:c((()=>[m(E).branchList.length&&m(E).branchMode===m(ee).repoBranch?(i(),M(o,{key:0,label:e.$t("config.selectBranch")},{default:c((()=>[r(S,{modelValue:m(E).selectedBranch,"onUpdate:modelValue":a[5]||(a[5]=e=>m(E).selectedBranch=e),filterable:!0,style:d({width:"calc(100% - "+R.value+"rem)"}),placeholder:e.$t("config.placeholder2"),onChange:de},{default:c((()=>[(i(!0),s(V,null,A(m(E).branchList,((e,a)=>(i(),M(_,{key:a,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","style","placeholder"]),r(O,{"box-width":R.value,"data-type":"branch"},null,8,["box-width"])])),_:1},8,["label"])):z("",!0)])),_:1},8,["label-width","label-position","element-loading-text"])),[[J,y.value]]):z("",!0),m(E).token&&m(E).selectedBranch?C((i(),M(w,{key:2,"label-width":m(De)(m(G)),"label-position":m($e)(m(G)),"element-loading-text":e.$t("config.loading5")},{default:c((()=>[m(E).selectedBranch?(i(),M(o,{key:0,label:e.$t("config.dirMode")},{default:c((()=>[r(F,{modelValue:m(E).dirMode,"onUpdate:modelValue":a[6]||(a[6]=e=>m(E).dirMode=e),onChange:Z},{default:c((()=>[r(f,{content:e.$t("config.inputNewDir"),placement:"top",offset:-1},{default:c((()=>[r(H,{label:"newDir"},{default:c((()=>[v(b(e.$t("config.createNewDir")),1)])),_:1})])),_:1},8,["content"]),r(f,{content:e.$t("config.rootDir2",{branch:m(E).selectedBranch}),placement:"top",offset:-1},{default:c((()=>[r(H,{label:"rootDir"},{default:c((()=>[v(b(e.$t("config.rootDir")),1)])),_:1})])),_:1},8,["content"]),r(f,{content:e.$t("config.autoDir2"),placement:"top",offset:-1},{default:c((()=>[r(H,{label:"autoDir"},{default:c((()=>[v(b(e.$t("config.autoDir")),1)])),_:1})])),_:1},8,["content"]),m(E).dirList.length&&"newBranch"!==m(E).branchMode?(i(),M(f,{key:0,content:e.$t("config.repoDir2",{branch:m(E).selectedBranch}),placement:"top",offset:-1},{default:c((()=>[r(H,{label:"repoDir"},{default:c((()=>[v(b(e.$t("config.repoDir",{repo:m(E).selectedRepo})),1)])),_:1})])),_:1},8,["content"])):z("",!0)])),_:1},8,["modelValue"])])),_:1},8,["label"])):z("",!0),"autoDir"===m(E).dirMode?(i(),M(o,{key:1,label:e.$t("config.autoDir")},{default:c((()=>[r(l,{modelValue:m(E).selectedDir,"onUpdate:modelValue":a[7]||(a[7]=e=>m(E).selectedDir=e),readonly:""},null,8,["modelValue"])])),_:1},8,["label"])):z("",!0),"rootDir"===m(E).dirMode?(i(),M(o,{key:2,label:e.$t("config.rootDir")},{default:c((()=>[r(l,{modelValue:m(E).selectedDir,"onUpdate:modelValue":a[8]||(a[8]=e=>m(E).selectedDir=e),readonly:""},null,8,["modelValue"])])),_:1},8,["label"])):z("",!0),"newDir"===m(E).dirMode?(i(),M(o,{key:3,label:e.$t("config.createNewDir")},{default:c((()=>[r(l,{ref_key:"newDirInputRef",ref:j,modelValue:m(E).selectedDir,"onUpdate:modelValue":a[9]||(a[9]=e=>m(E).selectedDir=e),onInput:a[10]||(a[10]=e=>m(ve)()),clearable:"",placeholder:e.$t("config.placeholder4")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])):z("",!0),m(E).dirList.length&&"repoDir"===m(E).dirMode&&"newBranch"!==m(E).branchMode?(i(),M(o,{key:4,label:e.$t("config.selectDir")},{default:c((()=>[r(W,{"el-key":q.value,"el-size":m(G).elementPlusSize},null,8,["el-key","el-size"])])),_:1},8,["label"])):z("",!0)])),_:1},8,["label-width","label-position","element-loading-text"])),[[J,g.value]]):z("",!0),m(E).token?(i(),M(w,{key:3,"label-width":m(De)(m(G)),"label-position":m($e)(m(G))},{default:c((()=>[r(o,{class:"operation"},{default:c((()=>[m(E).owner?(i(),M(u,{key:0,plain:"",disabled:N.value,type:"warning",onClick:a[11]||(a[11]=e=>m(ye)())},{default:c((()=>[v(b(e.$t("reset")),1)])),_:1},8,["disabled"])):z("",!0),m(E).selectedRepo?(i(),M(u,{key:1,plain:"",disabled:N.value,type:"primary",onClick:m(_e)},{default:c((()=>[v(b(e.$t("confirm")),1)])),_:1},8,["disabled","onClick"])):z("",!0)])),_:1})])),_:1},8,["label-width","label-position"])):z("",!0)])}}}),[["__scopeId","data-v-16673559"]]);export{Ie as default};
